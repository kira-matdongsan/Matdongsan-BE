name: ğŸ§ª Discord Webhook Test

on:
  workflow_dispatch:

jobs:
  test-discord:
    runs-on: ubuntu-latest

    steps:
      - name: Capture Start Time
        id: start
        run: |
          echo "start_time=$(date +%s)" >> $GITHUB_OUTPUT
          echo "start_iso=$(date --iso-8601=seconds)" >> $GITHUB_OUTPUT

      - name: Notify Discord - START ğŸš€
        uses: tsickert/discord-webhook@v7.0.0
        with:
          webhook-url: ${{ secrets.DISCORD_WEBHOOK_API }}
          username: "Matdongsan CI/CD"
          avatar-url: "https://i.pinimg.com/736x/b1/6a/68/b16a68e999f2a3410290fbb745071752.jpg"
          embed-title: "ğŸš€ í…ŒìŠ¤íŠ¸ ë°°í¬ ì‹œì‘"
          embed-url: "https://github.com/${{ github.repository }}/actions/runs/${{ github.run_id }}"
          embed-description: |
            - ğŸŒ¿ ë¸Œëœì¹˜: `${{ github.ref_name }}`
            - ğŸ‘¤ ì‹¤í–‰ì: `${{ github.actor }}`
            - ğŸ“ ì›Œí¬í”Œë¡œê°€ ì‹œì‘ë˜ì—ˆìŠµë‹ˆë‹¤.
          embed-color: 16776960 # ë…¸ë‘
          embed-timestamp: ${{ steps.start.outputs.start_iso }}

      - name: Simulate Work
        run: sleep 5

      - name: Capture End Time and Duration
        id: end
        run: |
          end_time=$(date +%s)
          start_time=${{ steps.start.outputs.start_time }}
          duration=$(( end_time - start_time ))
          echo "duration=${duration}" >> $GITHUB_OUTPUT
          echo "end_iso=$(date --iso-8601=seconds)" >> $GITHUB_OUTPUT

      - name: Notify Discord - SUCCESS âœ…
        if: success()
        uses: tsickert/discord-webhook@v7.0.0
        with:
          webhook-url: ${{ secrets.DISCORD_WEBHOOK_API }}
          username: "Matdongsan CI/CD"
          avatar-url: "https://i.pinimg.com/736x/b1/6a/68/b16a68e999f2a3410290fbb745071752.jpg"
          embed-title: "âœ… í…ŒìŠ¤íŠ¸ ì„±ê³µ"
          embed-url: "https://github.com/${{ github.repository }}/actions/runs/${{ github.run_id }}"
          embed-description: |
            ì›Œí¬í”Œë¡œê°€ ì„±ê³µì ìœ¼ë¡œ ì‹¤í–‰ë˜ì—ˆìŠµë‹ˆë‹¤.  
            â±ï¸ ì†Œìš” ì‹œê°„: `${{ steps.end.outputs.duration }}ì´ˆ`
          embed-color: 5763719 # ì´ˆë¡
          embed-timestamp: ${{ steps.end.outputs.end_iso }}

      - name: Notify Discord - FAIL âŒ
        if: failure()
        uses: tsickert/discord-webhook@v7.0.0
        with:
          webhook-url: ${{ secrets.DISCORD_WEBHOOK_API }}
          username: "Matdongsan CI/CD"
          avatar-url: "https://i.pinimg.com/736x/b1/6a/68/b16a68e999f2a3410290fbb745071752.jpg"
          embed-title: "âŒ í…ŒìŠ¤íŠ¸ ì‹¤íŒ¨"
          embed-url: "https://github.com/${{ github.repository }}/actions/runs/${{ github.run_id }}"
          embed-description: |
            ì›Œí¬í”Œë¡œê°€ ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.  
            â±ï¸ ì†Œìš” ì‹œê°„: `${{ steps.end.outputs.duration }}ì´ˆ`
          embed-color: 15548997 # ë¹¨ê°•
          embed-timestamp: ${{ steps.end.outputs.end_iso }}